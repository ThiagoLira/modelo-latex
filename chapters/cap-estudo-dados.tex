\chapter{Estudo dos Dados}
\label{cap:estudodados}


\section{Preparo dos Dados}


Os dados estão distribuícdos em colunas com diversas propriedades analisadas em
laboratório de cada lote retirado da fábrica. Existem diversas planilhas para
lotes retirados de diversas partes do processo de fabricação. Devido a dificuldades logísticas de se casar um
mesmo lote de cimento em diferentes partes do processo (e.g. o mesmo lote ao
sair do forno e depois de finalizado e pronto para expedição), estudos serão feitos apenas para os dados de
\textit{expedição de cimento}. 

A Tabela~\ref{tb:vars} define todas as variáveis, dependentes e independentes,
que são usadas na modelagem.


\begin{table}[]
  \resizebox{\textwidth}{!}{\begin{tabular}{|l|llllll}
\cline{1-1}
\multicolumn{1}{|c|}{\textbf{Unidade/ Variáveis}}         &                                &                              &                           &                             &                               &                               \\ \hline
Composição Química (\%)                                   & \multicolumn{1}{l|}{$AL_20_3$} & \multicolumn{1}{l|}{$SIO_2$} & \multicolumn{1}{l|}{MGO}  & \multicolumn{1}{l|}{RICARB} & \multicolumn{1}{l|}{$P_2O_5$} & \multicolumn{1}{l|}{$F_2O_3$} \\ \hline
Água (\%)                                                 & \multicolumn{1}{l|}{AGP}       &                              &                           &                             &                               &                               \\ \cline{1-3}
Tempo até o começo e fim do endurecimento do material (s) & \multicolumn{1}{l|}{IP}        & \multicolumn{1}{l|}{FP}      &                           &                             &                               &                               \\ \cline{1-3}
Finura Blaine ($cm^{2}$/g)                                & \multicolumn{1}{l|}{SBL}       &                              &                           &                             &                               &                               \\ \cline{1-4}
Resistência Compressiva do Cimento (kPA)                  & \multicolumn{1}{l|}{RC3}       & \multicolumn{1}{l|}{RC7}     & \multicolumn{1}{l|}{RC28} &                             &                               &                               \\ \cline{1-4}
\end{tabular}}
\caption{Variáveis presentes nos dados de expedição de cimento cedidos pela Intercement}
\label{tb:vars}
\end{table}

Os dados de expedição de cimento são anotados aproximadamente por dia, possuindo 2520
entradas para 3650 dias distintos. Existem dias sem dados presentes. O
período contemplado pela planilha de dados vai do dia 02/01/2008 até o dia 29/12/2018.

\subsection{Dados faltantes}

Embora tenhamos uma quantidade razoável de dias com dados presentes, esses muitas vezes não possuem algum valor de alguma coluna.
A seguir vemos para os dados de Expedição de Cimento, para cada uma de suas colunas, a porcentagem de dados presentes. 


\begin{figure}[H]
  \centering
  \includegraphics[width=0.9\columnwidth]{slides_dados_pct.pdf}
  \caption{Porcentagem de dados faltantes por Coluna para dados de Expedição de Cimento}
  \label{fig:dadosfalta}
\end{figure}


\section{Reamostragem dos dados}

Uma dos requisitos dos dados assumidos pelos modelos temporais, é que os mesmos
são espaçados regularmente pelo incremento de tempo escolhido, sem lacunas.
Portanto, os dados foram modificados para que entradas anotadas no mesmo dia
sejam unificadas em um único dia. Além disso, para dias no intervalo de tempo
estudado que não possuam entradas, foram criadas entradas com valores
artificiais que não perturbem a distribuição dos dados, e.g. os valores da
última entrada válida são copiados para frente até que se possua um novo valor.

A Figura \ref{fig:reamos} mostra como os dados estavam antes da reamostragem
para que eles se tornem diários: 

\begin{figure}[H]
  \centering
  \includegraphics[width=0.5\columnwidth]{slides_dados_antes_resample.pdf}
  \caption{Distribuição das distâncias entre entradas subsequentes dos dados de Expedição de Cimento, antes da reamostragem.}
  \label{fig:reamos}
\end{figure}



\section{Testes de Sazonalidade}

Diversas publicações recentes estudam a eficácia de modelos de Deep Learning
para predição de séries temporais, como consumo de energia elétrica
\citep{lstmbr}. Os dados estudados nesse documento são séries temporais dado que
são indexados pelo tempo, porém, resta analisar características temporais desses
dados. Como exemplo, \cite{lstmbr} usaram a informação do mês atual como
parâmetro para prever o consumo de energia elétrica. Dados que não possuem nenhuma característica temporal (i.e. a ordem não importa) seriam por exemplo provenientes de um estudo do salário recebido por uma amostra da população dados fatores como gênero, escolaridade e idade. No primeiro exemplo temos um caso de \textbf{sazonalidade} nos dados, algo que pode ser analisado em séries temporais com testes de análise espectral e auto-correlação. Para os dados desse problema, iremos testar a sazonalidade dos preditores de dureza do cimento.

\subsection{Análise Espectral}

Uma maneira de testar sazonalidade de dados indexados temporalmente é usar a
técnica de Transformada de Fourier \citep{spec}, onde podemos estudar quais
frequências dentro de um espectro podem ser usadas para decompor um sinal (i.e.
nossos dados). Para essa análise usamos os índices de dureza contidos nos dados
de expedição, de 2008 até 2014 e descartamos a parte imaginária da análise já
que nossos dados não possuem parte complexa \citep{spec}. Seguem os resultados:

\begin{figure}[H]
\centering
\includegraphics[width=0.9\columnwidth]{FFT_RC28.png}
\caption{Análise Espectral para preditor RC28}
\end{figure}


Podemos notar que a "energia" do sinal não possui picos em nenhuma frequência além da frequência zero, que seria a potência média do sinal, ou seja, uma componente que não depende do tempo. Então, afirmamos que esses dados não possuem sazonalidade mensal ou anual. O que significa que a média e a variância desses indicadores não possuem tendências e.g. alguma mudança similar todo mês de Janeiro.


\section{Correlação entre Colunas}

Vamos analisar agora a \textit{correlação} entre colunas dos dados de expedição
de cimento. Usaremos sempre a \textit{correlação de Pearson} para os cálculos.
\\
Sejam dois vetores de
dados $\{x_1,x_2, \dots , x_n\}$ e $\{y_1,y_2, \dots , y_n\}$, ambos com $n$ entradas. A correlação de Pearson $r$ é calculada
por meio da seguinte fórmula, onde $\overline{x}$ denota a média amostral do
vetor $X$: \\



\[ r = \frac{{}\sum_{i=1}^{n} (x_i - \overline{x})(y_i - \overline{y})}
{\sqrt{\sum_{i=1}^{n} (x_i - \overline{x})^2(y_i - \overline{y})^2}} \] 


\bigskip

\subsection{RC3, RC7 e RC28}

Assim como proposto em \cite{grecialin}, iremos usar dados supostos disponíveis diariamente no chão de fábrica. Portanto, para um lote recém expedido,
não podemos usar os índices RC3 e RC7 desse mesmo lote para auxiliar na predição
de RC28, visto que esses ainda não foram experimentados em laboratório. Dessa maneira, iremos usar os últimos índices RC3 e RC7 disponíveis para o lote expedido no dia $t$,
i.e. o índice RC3 do lote do dia $t-3$ e RC7 do lote dia $t-7$, que acabaram de ser medidos. 

A Figura~\ref{fig:gridcorr} mostra um correlograma entre os índices RC3 e RC7
atrasados e o RC28 diário. 

\begin{figure}[H]
  \centering
  \includegraphics[width=0.9\columnwidth]{corr_grid.pdf}
  \caption{Correlograma dos índices de resistência compressiva}
  \label{fig:gridcorr}
\end{figure}

A Tabela~\ref{tabelacorr} mostra o restante das correlações entre as demais
colunas de dados e o nosso objetivo, o índice RC28:


\begin{table}[H]
  \centering
\begin{tabular}{lr}
  \toprule
  {} &      RC28 \\
  \midrule
  AGP   &  0.592847 \\
  AL2O3 &  0.463414 \\
  SIO2  & -0.053178 \\
  MGO   & -0.371414 \\
  IP    & -0.132297 \\
  FP    & -0.419800 \\
  SBL   &  0.396555 \\
  PF    & -0.480720 \\
  P2O5  &  0.292252 \\
  RC28  &  1.000000 \\
  \bottomrule
  \label{tabelacorr}
\end{tabular}
\end{table}



\section{Normalização}

Os dados foram normalizados pelo método min-max. Essa técnica foi escolhida pelo
fato da distribuição de muitos das colunas não ser normal.

Seja um vetor $X = \{x_1,x_2,\dots,x_n\}$ . Podemos normaliza-lo por esse método usando a
seguinte transformação:


\[
x^*_{i} = ( x_i - Min(X))/(Max(X) - Min(X)) 
\]

$Min(X)$  e $Max(X)$ são constantes que devem ser guardadas para posterior
desnormalização do vetor.





%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../quali"
%%% End:
